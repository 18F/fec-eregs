language: python
sudo: false
python:
- '2.7'
env:
  global:
  - secure: BUm/CFQjB8gJxE4BJ3QVFfJ7NF7PG+REajGCikruo/SwreQWx5lQNL6qN7/bj0FzlU5gyg79oph3BHPFKKgZwXQlQYqsPGyY5NSj9VLZUX9yb/D4oBJcCYLAp3Fa6QvyYAMJUkBPfIawLZ+LHncCiJRID+jhfNMviH0X2R3ZYHHwsE8FFWTvsosYiho47inMZye2SdMxBCli0lqJeUInFFNS2QWmoF4fdWJ4TwNoWHw12LmeO6WoQMy6e/LHqEwD2BaAmokn+aXjqfC+p74nJv5t8dQGbQGc75MjP8i/4GvoJ6Ig9yTtEuYeeDH9vbKpzPHYoJqNVuSJFM2PWQOF764+6yTsTSSyEYkDqngbSC/s+oDAN8lyDpNOjm01EWkkkV9sXsCZV2FvvqSdxNpK5cbDpl5yS+pEWXoFGLsCBGRSSR9OMC2YiCrrz2wTSiziYuGNtPxNn0kJI/JYfMLEZiTGGpT8rRzP/DR2XxP3gy8DKBOOT2xSycAq7jEcMfbxPzIjoXt77nZUeSLu4YiRhsSZOtV/LjpM6J7QqRXch0WUpRxdQO3tFhR5OqxfzSSbvxHSIVjFgM1P0kj8NSMWt2gd3RlyUS0PK5rYs5UsEqPJW1ghyipOMtrAC+7xmDqRsgdBrOb3bFAUq5qeM2XQtZ98MtnQ9jBP0I+9NMF0Tis= # user name stage
  - secure: Kry+ITgVQKOisV8is2zIp6zjNMwwGf1g2cB0nlo37kBTh2TXFcvSbd0lS37IWoOucnaQW4/u3Ylaq7c5hiGgE+8CfjGeMVtfNQW88v+3Y3Fuj44auPRBFuEHn7jRmqjyhJjPACHk2zNI6tKP1CTdQFGUITbMwz9qv22ijckADlNUpk0c796vuhAybfqQXsoeFQ4kiYGCFwxpgrMI8HDyLFDv2Pl4XNwEe/G25VLHzUcUyxpPtYNA2/jXkZfHKgg52CfLrbPeYEzv77tJoQm1Cto3QbeEyM0um1HsovNuOC9Og3yKpRq+Y3dsU8Wf84jiDmR0f4vsNoo0VVRMzKlPVp6INtfgRRDkymNcglQ+6Aj42gMNnoZkLrbL6ixZxY0tCHfo+tKFltuaA8cgPJmjwEjLPtlOC1sNHPZeaarAuuJugRrZ91WWVbiQkIr3ZSCUMF+MNGALiB14aZ5kqmTgb+cCzfbLTmR55UzCtgosa6qgdKSZ31RLGg3UpZab37omWE1VaZt4uwWh5vqCkgGADBK022TqxdobDN1wwDZsHAgpbFyhah3MebkOI9vv2fNL2Pa06viunJZ1Cw140OrloXhXP/9uEIx7ozOaRb2gkSUK4G4vkPwQa/iHlHn0DZzw/AhRxiv5wHn3MJLtKYeneZUKYZ8WC2bsI19aUmNobaI= # password stage
  - secure: BIqLQBY+4yIGHq6Qmp9LAzQr5jDCVBMaiatlzxUvfcHShpRWqWZ0BN6IkMesqafjLyu5SzNxNGXmVz6IGKDMxLCtI350fwrjSgOJzJW4llaSeHT12XklE7KjtFO2zZzhFknzRcjhjTFk/dy8C65NKNfc0OK2xTnLAFs1On62Q8u9L2gpofCicpQ7yenIAFpw9gxaSU6WrzMdNR8lcQI/9F1ao5trY4MIt5GscBibDe+2FXaFautS4Y2eIxqSHjV+Eb2PldaiENnnorDS0kj8xN4icnrgU9X4wf16L3x48F5O4Vdpmr0Iv3R/oMXF/pV+yoi00ouCboWrUcgdPg7qeqNp/vZo/Ew43ifN3RD+mdZ/3L12ItDLksE6DB1ElWbFopz+wSbU7g1i+592hViXyx+Fb6lUvXceqjwOzQsBQn/1auhhlOSpJ1VQ47vvWsV/N8eJyjW0LqB/LeVtxgF3G7QrYYGl0wa3rQnAio2rg3c08cBeSTe0XI5EYOk2v1YkisCI/z3gRGCtK6RSh86CJGv4mgv2xYWjwfoZM/kIDn1I3xvFuZ0jGDhPu7P0o/t5oZb7End4k9expu3zSDbu02zu+Mq7uE6vH6N0YZY8nC0yJIFt5ge0Z0ojEMo0YKrHvnIiLWU9oYTaeo0Md+ZYAivWnRAiDBY1i8JzFLnEhuw= # dev username
  - secure: RMZnD7ktcxq0TSOanEr9Q6yTlCj+f38EgPgxxYL6+tSP5PxupaacvTOxLfe0ktn8MuGAA/+WRvSFy5tGeUiJ5Y2UoT6JEGuhlCI1ax9xxTE+r26GLQJml0xvebGh3jqXIkLmRELyY/u9jS6EmjFoWCk9YGkWrBj20qhf+lK0HQWoWCn/o/hJC2CdaY0e3ImzVmQAkgOlynVdii8souTRSusB3tdKcyQCMsl2lYw2kNZ2kaxdYCCYXNh/osiSUGVgXWplfXepO//l6j0IxGYSKEJWz9igWpxfYpdIMI6RLZVmwxtHCBZ/V65i6CPhc5FbmIVfbQIDUItFDGYhcxUL+JPyYAgKtrhu2xMvxdKZ95tz5Nogh83qy3iogO8JTaqRw2eCK5MbTAJ7/hLjR6fWU/aJTcLq6fbm+eeUNGW8KN4VYkc7yI2DuAtXsHLTGd12pYsnPCDpb+myLapPKJhlbcm0Qg2K2XN7sKYGX/MUPSgHlyK19W+kxGoa4+1kCoHqkfy7aLMwBTy+YqsWaq6v+ZmmqwJYo03VCW6dPvS9+/Qi++pRDi97WLhyUwHVKH8KCJRDPPSezmPBtCK2+cC8531NffXGAbOUH7dD5q0OMF1yolYrLeaKUqGR2urqjAOKhmCmfHVB8AdRs5veEsjgDN0cJ9w9qI15akIKpwAyEtc= # dev password
  - secure: sZeSA+YafbKrK5MFrLBkqQv7WYY6st8y023y/ZoyRj2eczFN58WZ8fEBO4ygaYLsG/gsVXbWIbfA+qWlkyQZp4qenoUqpGgCSRQDmToc27lNKeIiV1cEMm2oWv+46bSIuAEgrYpSU23abK3+jRDiaSsfKV1oNeOmmO4jn1bD/YOn/77kBvJW/8lJ/ilw9NNPfskkh9Xpmm2iH4xbrF2UGZcGUp3vwpL0TvLu/TDb6yNKpKWKf7Ov21rO+UrQnwzgyjYwixeuaS0RXuUGFfUHelDsubmasKjqLyTIPASie6M7T5PVIwI/bkM3mnRy355K0E+24D6ZPC7vN9UW8CkzblPtBkCdsKXHQlapVywKWqbW2kPtAtHvMRKlAmO81PQ2QLPgSXhzL2GA5nNV1EhlI3/UNkfkQA4wwquAX+BafXAtVfPLpnJoGiI5C7rFnOjFdXwPN2d3YifuRPGRbC0uXzeBohgRZYbQdwpA+/NlkYdyvYWcQ44NUWkDx4BVQAF6NC8ckOXvgV0Lb2rSu6Jze8gSypwVIUzj5F5rVvXsuTqCLCPnMK0PJ2jQ9NDlIGj8x4VaUGJlUvvDP2CxSqe82IxOJCrD7WAK9iHHWF1zagy7s0fEni3PyNawW/++Jlrzjyk2LRLWYrnQdV411qUVm51cuw4LDggcetsy/+BDEl0= # prod username
  - secure: Rp5YILJQKOP1JR2tzaEskwiilJ95IZqpETBtVlAF1LFOYNulKHuM13hHCyRAI4JTwN+6VPiiydK4YbGNxyBJI1DK0mxXoSInU33vclKc7K4ODnusgqpwHvctYkvs4/ISCsTuKhtMHjyH/TLJjwAlpmGlhem0qOMQJm0nA7xM4c7Wla+gQlVn7X7+dB11snW8IneKUL6usQK8zDAug6ZtA7xxuQIPHBHwyfJzXFumL9sCY3LbauL0PTdRWpIZ74sd35TSMh853tA+eZDg24bzXCdtKL9P1OskvO9YxkXDuBK+Ff02vyHFJmjxGI/gA4TjrjwBMh72ZUostC7nV5VOz4qfRcwGrfCDc6QbF1uQBajQ84rCXe1p/d83O/pnx/yHaygU/AwnZVGJicwzl7Ma+zoa/22iXhULn38s0YRRDp3mlAOxY+cZQA+0MmgcdmcXrDtav/2yDGLgsLyTyI1nq2CcjMLmBj16J0qEqrXWy2SLHQrjUEWA0L6gVr9fwlWj5KTIWVyo/MqwKia5Kn1B9ZfiQn6cwR2fWy74qVR8O1sVJ0oGWqCTNjLSF1E++DdJAqnLFa2dXcQx5LK/dr7tN7tP7utSQH2tFJd1xXqYkeBG8FrfhUHiYi8kpgI0C7933KA7jDgNpPVpzWy3rRBh3PfKwke4qyLtb7fyvBwHsAs= # prod password
before_install:
- gem install sass
install:
- pip install -r requirements.txt
- pip install -r requirements_test.txt
- pip install -r requirements_dev.txt
- npm install -g grunt-cli bower
- npm install
script:
- npm run build
- python manage.py migrate --fake-initial
- python manage.py compile_frontend
- python manage.py test
before_deploy:
- travis_retry pip install bandit
- cd ..
- bandit -r fec-eregs/fec_eregs "fec_eregs/*.py"
- cd fec-eregs
- mkdir $HOME/bin
- export PATH=$HOME/bin:$PATH
- travis_retry curl -L "https://cli.run.pivotal.io/stable?release=linux64-binary&version=6.25.0" | tar xzv -C $HOME/bin
- travis_retry cf install-plugin autopilot -f -r CF-Community
after_deploy:
- curl --silent --fail --head https://fec-dev-eregs.app.cloud.gov/regulations || travis_terminate $?
- curl --silent --fail --get https://fec-dev-eregs.app.cloud.gov/regulations/api/regulation/2 > /dev/null || travis_terminate $?
deploy:
  provider: script
  skip_cleanup: true
  script: invoke deploy --branch $TRAVIS_BRANCH --login True --yes
  on:
    all_branches: true
